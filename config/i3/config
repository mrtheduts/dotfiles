# mrtheduts' i3 config file
# inspired by Doug Black's https://dougblack.io/words/a-good-vimrc.html

# User Variables {{{

    # $mod as Win key
    set $mod Mod4

    # Command to lock the screen
    set $lockscreen "physlock -p 'Hello, friend' -m"

    # Wallpaper setter
    set $set_wallpaper feh --no-fehbg --randomize --bg-fill /home/mrtheduts/Imagens/wallpapers/galaxies/purple_1.jpg

    # Command to execute script changing USB_Sound_Card module
    # set $reload_line_in_module ~/Scripts/unload-and-load-line-in-module.sh
    #
    # Default terminal
    set $term terminator

    # Notify daemon
    set $notify_daemon "dunst --config ~/.config/dunst/dunstrc"

    # Polkit Agent
    set $polkit_agent "polkit-dumb-agent"

    # Window Compositor
    set $window_compositor "picom -b --config ~/.config/picom/picom.conf"

    # Touchscreen script
    set $toggle-touchscreen "/home/mrtheduts/Scripts/toggle-touchscreen.sh TOGGLE"
    set $off-touchscreen "/home/mrtheduts/Scripts/toggle-touchscreen.sh OFF"

# }}}

# Exec on startup {{{

    # Window compositor
    exec --no-startup-id $window_compositor
    # Set wallpaper
    exec --no-startup-id $set_wallpaper
    # Execute script of mine that handles USB Card Module 
    # exec --no-startup-id $reload_line_in_module
    # Open pavucontrol and pulseeffects
    # exec --no-startup-id pulseeffects --gapplication-service -l "Bass Enhancing + Perfect EQ"
    exec --no-startup-id $notify_daemon

    # polkit
    exec --no-startup-id $polkit_agent

    exec --no-startup-id libinput-gestures-setup start

    exec --no-startup-id $off-touchscreen

# }}}

# Bindsyms {{{

    # Screen Lockers {{{
        # Lock screen and ttys
        bindsym $mod+Mod1+l exec $lockscreen
        # Lock keyboard and mouse only, keeping screen on
        bindsym ctrl+shift+l exec xtrlock
    # }}}

    # Pulse Audio controls {{{
        # Raise Master volume in 5%
        bindsym XF86AudioRaiseVolume exec amixer -q -D pulse sset Master 5%+ on
        # Lower Master volume in 5%
        bindsym XF86AudioLowerVolume exec amixer -q -D pulse sset Master 5%- on
        # Toggle Master to mute/unmute
        bindsym XF86AudioMute exec amixer -q -D pulse sset Master toggle
    # }}}

    # Media Player controls {{{
        bindsym XF86AudioPlay exec playerctl play
        bindsym XF86AudioPause exec playerctl pause
        bindsym XF86AudioNext exec playerctl next
        bindsym XF86AudioPrev exec playerctl previous
    # }}}

    # Printscreen {{{
        # Import root window as png and save to clipboard
        bindsym Print exec import -window root png:- | xclip -selection clipboard -t image/png

        # Import focused window as png and save to clipboard
        # TODO: make it work for floating focused windows. Is it possible?
        bindsym $mod+Print exec \
        import -window $( \
            i3-msg -t get_tree | \
            jq 'recurse(.nodes[]) | select(.focused).window' \
        ) png:- | \
        xclip -selection clipboard -t image/png

        # Execute Flameshot with edit tools
        bindsym ctrl+Print exec flameshot gui

        # Save Screen with Flameshot
        bindsym shift+Print exec flameshot full -p ~/Pictures/Screenshots
    # }}}

    # Floating video mode {{{
        # Run script to move focused window to the
        # bottom-left corner of the screen, floating
        bindsym $mod+y exec /home/mrtheduts/Scripts/move-window-to-corner.sh
        # Undo it
        bindsym $mod+Shift+y fullscreen disable; floating disable; sticky disable;
    # }}}
 
    # Application openers {{{
        # Rofi with run and window mode 
        bindsym $mod+d exec "rofi -modi combi -combi-modi window,drun -show combi -theme sidebar -show-icons -font 'NotoSans Nerd Font 14'"

        # dmenu for when in tablet mode
        bindsym $mod+Shift+d exec "dmenu_run"
    # }}}

    # Containers-related {{{

        # Toggle stickyness of focused container
        bindsym $mod+shift+s sticky toggle

        # Move window to center
        bindsym $mod+c move position center

    # }}}

    # Open default terminal
    bindsym $mod+Return exec $term

    # Toggle touchscreen On/Off with Power Button
    # bindsym XF86PowerOff exec /home/mrtheduts/Scripts/toggle-touchscreen.sh

    # Set wallpaper
    bindsym $mod+shift+w exec $set_wallpaper

    # Change wallpaper to Writing Mode
    # bindsym $mod+ctrl+w exec feh --no-fehbg --bg-fill ~/Pictures/wallpapers/landscapes/pink_art_sky.jpg

    # Reload the configuration file
    bindsym $mod+Shift+c reload

    # Restart i3 inplace (preserves your layout/session, can be used to upgrade i3)
    bindsym $mod+Shift+r restart

    # Exit i3 (logs you out of your X session)
    bindsym $mod+Shift+e exec "i3-nagbar -t warning -m 'You pressed the exit shortcut. Do you really want to exit i3? This will end your X session.' -b 'Yes, exit i3' 'i3-msg exit'"

    # Send to scratchpad
    bindsym $mod+Shift+minus move scratchpad

    # Bring back from scratchpad
    bindsym $mod+minus scratchpad show

    # Change brightness
    bindsym XF86MonBrightnessUp exec xbacklight -inc 10
    bindsym XF86MonBrightnessDown exec xbacklight -dec 10

    # Toggle touchscreen state
    bindsym XF86PowerOff exec $toggle-touchscreen

# }}}

# Window-related configs {{{

    # Change focus {{{
        #Change focus to left
        bindsym $mod+Left focus left
        bindsym $mod+h focus left
        #Change focus to down 
        bindsym $mod+Down focus down
        bindsym $mod+j focus down
        #Change focus to up 
        bindsym $mod+Up focus up
        bindsym $mod+k focus up
        #Change focus to right 
        bindsym $mod+Right focus right
        bindsym $mod+l focus right

        # Focus the parent container
        bindsym $mod+a focus parent
        # Focus the child container
        bindsym $mod+z focus child

        # Change focus between tiling / floating windows
        bindsym $mod+space focus mode_toggle

    # }}}

    # Move focused window {{{
        # Move window towards the left
        bindsym $mod+Shift+h move left
        # Move window towards the bottom
        bindsym $mod+Shift+j move down
        # Move window towards the top
        bindsym $mod+Shift+k move up
        # Move window towards the right
        bindsym $mod+Shift+l move right
    # }}}

    # Resize window {{{
        # Grow width
        bindsym $mod+Ctrl+l resize grow width 1 px or 1 ppt
        # Shrink width
        bindsym $mod+Ctrl+h resize shrink width 1 px or 1 ppt
        # Grow height
        bindsym $mod+Ctrl+j resize grow height 1 px or 1 ppt
        # Shrink height
        bindsym $mod+Ctrl+k resize shrink height 1 px or 1 ppt
    # }}}

    # Layout-related {{{
        # Change container layout (stacked, tabbed, toggle split)
        bindsym $mod+s layout stacking
        bindsym $mod+w layout tabbed
        bindsym $mod+e layout toggle split

        # Split in horizontal orientation
        bindsym $mod+b split h
        # Split in vertical orientation
        bindsym $mod+v split v
    # }}}

    # Floating-related {{{
        # Set key to move floating windows
        floating_modifier $mod
        # Set maximum size for floating windows
        floating_maximum_size 1000 x 540
    # }}}

    # Toggle split into two monitors
    bindsym $mod+Mod1+shift+s exec "/home/mrtheduts/Scripts/virmon.sh FHD && i3-msg restart && $set_wallpaper", mode "default"
    bindsym $mod+Mod1+shift+h exec "/home/mrtheduts/Scripts/virmon.sh HALF && i3-msg restart && $set_wallpaper", mode "default"


    # Only exit fullscreen if popup belongs to
    # the fullscreen application
    popup_during_fullscreen smart

    # Toggle tiling / floating
    bindsym $mod+Shift+space floating toggle

    # Enter fullscreen mode for the focused container
    bindsym $mod+f fullscreen toggle

    # Kill focused window
    bindsym $mod+q kill

# }}}

# Workspace-related configs {{{

    # Workspace names {{{
        # We use variables to avoid repeating the names in multiple places.
        set $ws1 "1"
        set $ws2 "2"
        set $ws3 "3"
        set $ws4 "4"
        set $ws5 "5"
        set $ws6 "6"
        set $ws7 "7"
        set $ws8 "8"
        set $ws9 "9"
        set $ws10 "10"
    # }}}

    # Switch to workspace {{{
        # Jump directly to  specific workspace
        bindsym $mod+1 workspace $ws1
        bindsym $mod+2 workspace $ws2
        bindsym $mod+3 workspace $ws3
        bindsym $mod+4 workspace $ws4
        bindsym $mod+5 workspace $ws5
        bindsym $mod+6 workspace $ws6
        bindsym $mod+7 workspace $ws7
        bindsym $mod+8 workspace $ws8
        bindsym $mod+9 workspace $ws9
        bindsym $mod+0 workspace $ws10

        # Jump left/rigt one workspace
        bindsym $mod+Tab workspace next
        bindsym $mod+Shift+Tab workspace prev

        # Jump to previous workspace using 
        # the bindsym to jump to current workspace
        workspace_auto_back_and_forth yes

        # Workspace Monitor Config
        workspace $ws1 output HDMI-A-0~1 HDMI-A-0
        workspace $ws2 output HDMI-A-0~1 HDMI-A-0
        workspace $ws3 output HDMI-A-0~1 HDMI-A-0
        workspace $ws4 output DisplayPort-2 HDMI-A-0~1 HDMI-A-0
        workspace $ws5 output DisplayPort-2 HDMI-A-0~1 HDMI-A-0
        workspace $ws6 output DisplayPort-0 HDMI-A-0~2 HDMI-A-0
        workspace $ws7 output DisplayPort-0 HDMI-A-0~2 HDMI-A-0
        workspace $ws8 output DisplayPort-1 HDMI-A-0~2 HDMI-A-0
        workspace $ws9 output DisplayPort-1 DisplayPort-0 HDMI-A-0~2 HDMI-A-0
        workspace $ws10 output DisplayPort-1 DisplayPort-0 HDMI-A-0~2 HDMI-A-0
    # }}}

    # Move focused container {{{
        # Move to specific workspace directly
        bindsym $mod+Shift+1 move container to workspace $ws1
        bindsym $mod+Shift+2 move container to workspace $ws2
        bindsym $mod+Shift+3 move container to workspace $ws3
        bindsym $mod+Shift+4 move container to workspace $ws4
        bindsym $mod+Shift+5 move container to workspace $ws5
        bindsym $mod+Shift+6 move container to workspace $ws6
        bindsym $mod+Shift+7 move container to workspace $ws7
        bindsym $mod+Shift+8 move container to workspace $ws8
        bindsym $mod+Shift+9 move container to workspace $ws9
        bindsym $mod+Shift+0 move container to workspace $ws10
    # }}}

# }}}

# Appearance {{{

    # Hide borders on workspaces with one window
    hide_edge_borders smart

    # Small border for all windows
    for_window [class="^.*"] border pixel 2
    
    # Font for text border
    font pango:Hack Nerd Font 10

    # Border Colors - fragment created by:
    # https://thomashunter.name/i3-configurator/
    # class                 border  bground text    indicator child_border
    client.focused          #505050 #505050 #FFFFFF #505050   #505050
    client.focused_inactive #000000 #000000 #505050 #000000   #000000
    client.unfocused        #000000 #000000 #505050 #000000   #000000
    client.urgent           #900000 #900000 #FFFFFF #900000   #900000
    client.placeholder      #000000 #000000 #FFFFFF #000000   #000000
    client.background               #000000

    # Align container title to center
    title_align center

# }}}

# Program-specifc configs {{{

    # mGBA config
    for_window[class="^mGBA$"] floating enable, move position center;

    # Pavucontrol
    assign [class="Pavucontrol"] $ws10

    # Telegram
    # assign [class="TelegramDesktop"] $ws8

    # # Steam
    # assign [class="Steam"] $ws9

    # Google Play Music/Youtube Music
    assign [class="Google Play Music Desktop Player"] $ws9

# }}}

# Quick terminal {{{

    # Execute terminal on startup
    # exec --no-startup-id terminator -T "dropdown"
    # Move it to scratchpad
    # for_window [title="dropdown"] floating enable, move scratchpad;

    # Bindsym to toggle it
    # bindsym $mod+t [title="dropdown"] resize set 900 700 ; scratchpad show ; [title="dropdown"] move position center

# }}}

# Modes {{{

    # Container Edit Mode {{{

        set $container_edit Edit containers: (B/b)order, (f)ull HD size, (H)alf-size, (h/j/k/l) resize, (o)ne-third, (t)wo-thirds size:
        mode "$container_edit" {

            # Set/unset border
            bindsym b border pixel 0
            bindsym shift+b border pixel 2

            # Set container to FHD dimension
            bindsym f resize set width 1920 px

            # Set container to FHD dimension
            bindsym shift+h resize set width 1280 px

            # Resize container
            bindsym h resize shrink width 1 px
            bindsym j resize grow height 1 px
            bindsym k resize shrink height 1 px
            bindsym l resize grow width 1 px

            # Set size to one-third
            bindsym o resize set width 853 px

            # Set size to two-thirds
            bindsym t resize set width 1707 px

            # Back to normal: Enter or Escape
            bindsym Return mode "default"
            bindsym Escape mode "default"
            bindsym $mod+r mode "default"
        }
        bindsym $mod+r mode "$container_edit"

    # }}}

    # Monitor {{{
    # Mode to choose which screen to output to
        set $mode_monitor Monitor (n)notebook, (h)dmi, (e)xtend sideways
        mode "$mode_monitor" {
            # Use notebook screen
            bindsym n exec --no-startup-id "xrandr --output eDP1 --auto --primary && xrandr --output HDMI1 --off && $set_wallpaper && $wacom_to_edp1", mode "default"
            # Use HDMI
            bindsym h exec --no-startup-id "xrandr --output HDMI1 --auto --primary && xrandr --output eDP1 --off && $set_wallpaper", mode "default"
            # Extend HDMI above notebook screen
            bindsym e exec --no-startup-id "xrandr --output HDMI1 --auto --primary && xrandr --output eDP1 --auto --right-of HDMI1 --noprimary", mode "default"
            # Mirror (unused)
            #bindsym m exec --no-startup-id "xrandr --output eDP1 --auto --primary && xrandr --output HDMI1 --auto --same-as eDP1 --noprimary", mode "default"

            # Back to normal: Enter or Escape
            bindsym Return mode "default"
            bindsym Escape mode "default"
            bindsym $mod+p mode "default"
        }
        bindsym $mod+p mode "$mode_monitor"
    # }}}
 
    # System {{{
    # Mode to shutdown, reboot or suspend the machine ou exit i3wm
        set $mode_system System (e)xit, (s)uspend, (r)eboot, (Shift+s) shutdown
        mode "$mode_system" {
            # Exit i3wm
            bindsym e exec i3-msg exit, mode "default"
            # Suspend machine
            bindsym s exec systemctl suspend, mode "default"
            # Reboot machine
            bindsym r exec reboot, mode "default"
            # Shutdown machine
            bindsym Shift+s exec systemctl poweroff, mode "default"
            # Hibernate machine (unused)
            #bindsym h exec --no-startup-id /home/mrtheduts/Random/scripts/i3exit.sh hibernate, mode "default"

            # Back to normal: Enter or Escape
            bindsym Return mode "default"
            bindsym Escape mode "default"
        }
        bindsym $mod+Escape mode "$mode_system"
    # }}}

# }}}

# Bar {{{

    bar {
        # Use i3bar as frame
        i3bar_command i3bar --transparency
        # Command to output information to ther bar
        status_command bumblebee-status -m sensors memory disk:root disk:home nic amixer battery datetime -p interval=2.5 root.path=/ home.path=/home date.format="%a, %b %d %Y" -t greyish-powerline
        # Place it on top of the screen
        position top


        # Keep it hidden until $mod is held
        mode hide
        # hidden_state hide

        # Colours of the bar itself and i3 workspaces module
        colors {
            background #00000000

            # Color of the border, background and text of the i3 module buttons
            focused_workspace   #aaaaaaff #909090ff #303030ff
            inactive_workspace  #0a0a0aff #0a0a0aff #909090ff
            urgent_workspace    #ffffffff #af1818ff #ffffffff
        }

        # Font
        font pango:NotoSans Nerd Font 8
        # Show only workspace name after ":", if used
        strip_workspace_numbers yes
        # Space used near screen edges
        tray_padding 1

    }

# Bar-2 {{{

    bar {
        # Use i3bar as frame
        i3bar_command i3bar --transparency
        # Command to output information to ther bar
        status_command bumblebee-status -m date bashfuzzyclock -p interval=2.5 date.format="%a, %b %d %Y" -t greyish-powerline
        # Place it on top of the screen
        position top
        output HDMI-A-0~2

        # Keep it hidden until $mod is held
        mode hide
        hidden_state hide

        # Colours of the bar itself and i3 workspaces module
        colors {
            background #00000000

            # Color of the border, background and text of the i3 module buttons
            focused_workspace   #aaaaaaff #909090ff #303030ff
            inactive_workspace  #0a0a0aff #0a0a0aff #909090ff
            urgent_workspace    #ffffffff #af1818ff #ffffffff
        }

        # Font
        font pango:NotoSans Nerd Font 9
        # Show only workspace name after ":", if used
        strip_workspace_numbers yes
        # Space used near screen edges
        tray_padding 1

    }

# }}}
# }}}

# Open this file with folded Sections
# vim:foldmethod=marker:foldlevel=0
